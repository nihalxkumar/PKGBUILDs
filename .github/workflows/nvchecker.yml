name: Check for new versions

on:
  schedule:
    # Run every 12 hours
    - cron: '0 */12 * * *'
  # Allow manual trigger
  workflow_dispatch:

jobs:
  check-versions:
    runs-on: ubuntu-latest
    container:
      image: python:3.13-alpine
    steps:
      - uses: actions/checkout@v4

      - name: Install build dependencies
        run: apk add --no-cache build-base curl-dev python3-dev

      - name: Install nvchecker
        run: pip install nvchecker

      - name: Run nvchecker
        run: nvchecker -c nvchecker.toml

      - name: Create issue if updates available
        if: failure()
        uses: actions/github-script@v7
        with:
          script: |
            github.rest.issues.create({
              owner: context.repo.owner,
              repo: context.repo.repo,
              title: 'Package updates available',
              body: 'nvchecker found new versions. Run `nvchecker -c nvchecker.toml` locally to see details.',
              labels: ['dependencies', 'automated']
            })
